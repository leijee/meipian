!function(){wx.config({debug:!1,appId:_appId,timestamp:_timestamp,nonceStr:_nonceStr,signature:_signature,jsApiList:["chooseImage","uploadImage"]}),wx.error(function(t){alert(t.errMsg)});var c=location.protocol+"//www.lvman.net",t={ADDIMGARR:function(t,e){"object"==typeof(t.list=e)&&localStorage.setItem("imgArr",JSON.stringify(e))},TDEFAULTREF:function(t,e){t.t_default_ref=e,localStorage.setItem("t_default_ref",e)},EDITVALUE:function(t,e){t.editValue=e,localStorage.setItem("editValue",e)},CURRENTINDEX:function(t,e){t.index=e,localStorage.setItem("index",e)},SETTITLE:function(t,e){t.title=e,localStorage.setItem("title",e)},SETTINDEX:function(t,e){localStorage.setItem("t_index",parseInt(e))}},e={imgArrList:function(t){return t.list||JSON.parse(localStorage.getItem("imgArr"))},t_default_ref:function(t){return t.t_default_ref||localStorage.getItem("t_default_ref")},editValue:function(t){return t.editValue||localStorage.getItem("editValue")},index:function(t){return""!=t.index?t.index:localStorage.getItem("index")},title:function(t){return t.title||localStorage.getItem("title")},t_index:function(t){return localStorage.getItem("t_index")}},i=new Vuex.Store({state:{list:"",t_default_ref:"",editValue:"",index:"",title:"",t_index:0},mutations:t,getters:e,actions:{addItem:function(t,e){t.commit("ADDIMGARR",e)}}});function o(t,e,i){return t[e]=t.splice(i,1,t[e])[0],t}var s=new VueRouter({routes:[{path:"/",component:{template:'<div class="index-home" v-if="activePage">\n            <div class="home-header">\n                <div>\n                    <h2 class="header-title">开始创作</h2>\n                    <p class="header-text">可以添加100张美图哦</p>\n                </div>\n            </div>\n            <div class="home-body">\n                <div class="addPhoto">\n                    <input type="file" @change="changeImg($event)" accept="image/*" multiple="multiple" class="addPhoto-btn" id="addPhotoBtn">\n                    <p class="btn-add">+</p>\n                    <p class="text-add">添加照片</p>\n                </div>\n            </div>\n\n            <div class="home-footer" v-if="hideFooter">\n                <div class="footer-item">发现</div>\n                <div class="footer-item">\n                    <p class="btn-add">+</p>\n                    <p>开始制作</p>\n                </div>\n                <div class="footer-item">我的</div>\n            </div>\n        </div>',data:function(){return{activePage:!0,imgArr:[],hideFooter:!1}},created:function(){this.$store.commit("ADDIMGARR",[]),this.$store.commit("SETTITLE",""),this.$store.commit("CURRENTINDEX",""),localStorage.setItem("img_index",0),localStorage.setItem("v_index",0),localStorage.setItem("t_index",0)},mounted:function(){},methods:{changeImg:function(t){var e=t.target.files;this.imgArr=[];for(var i=0,s=e.length;i<s;i++){var n=a(e[i],this);this.imgArr.push({imgUrl:n,c_text:"",ref:"item"+i,c_ref:"c_item"+i,t_ref:"t_item"+i,type:1})}console.log(this.imgArr),this.$store.commit("ADDIMGARR",this.imgArr),this.$store.commit("SETTITLE",""),this.activePage=!1,this.activeSecond=!0,this.$router.push({path:"second"})}}}},{path:"/second",component:{template:'<div class="index-second" @click="hideAddFlag">\n            <div class="tab-bgImg" v-show="selectBgImg">\n               <div class="bg-item" v-for="(item,b) in bgImgArr" :key="b"  @click="selectBgImgFun(b,item.imgUrl)">\n                   <i :class="(b_img==b)?\'selected\':\'\'"></i>\n                   <img :src="item.imgUrl">\n               </div>\n            </div>            <div v-show="isShowHead" class="second-header">\n                <img class="bg_header" :src="headBgImg" alt="">\n                <div class="header-content">\n                    <textarea placeholder="点击设置标题" :value="title" class="content-title" @click.stop="addContent(\'contentTitle\',$event)"></textarea>\n                    <div class="content-bottom">\n                        <div class="bottom-item item-addMusic"><span @click.stop="addMusicFun">添加音乐</span></div>\n                        <div class="bottom-item item-setBg"><span @click="tabBgImgFun">更换封面</span></div>\n                    </div>\n                </div>\n            </div>\n            <div class="second-body">\n                <div class="body-item" v-for="(item,i) in imgArr">\n                    <div class="first-item" v-if="i == 0">\n                        <div class="addItem topItem" @click.stop="addTopFlag=false" v-show="addTopFlag">+</div>\n                        <div class="add-content" v-show="!addTopFlag">\n                        <input type="file" class="selectImg" accept="image/*" multiple="multiple" @change.stop="addImgFun(-1,$event)">\n                        <input type="file" class="selectVideo" accept="video/*" multiple="multiple" @change.stop="addVideoFun(-1,$event)">\n                        <span class="icon-text" @click.stop="addTextFun(-1)"></span>\n                        <span class="icon-img"></span>\n                        <span class="icon-video"></span>\n                        </div>\n                    </div>\n                    <div class="item-content">\n\t\t\t\t\t\t <i v-if="i!=0" class="icon-arrow-top" @click.stop="changeImgIndex(i,0,imgArr.length)"></i>\n\t\t\t\t\t\t <i v-if="i!=imgArr.length-1" class="icon-arrow-bottom" @click.stop="changeImgIndex(i,1,imgArr.length)"></i>\n                        <i class="close" @click="removeCurrentFun(i,item.type)"></i>\n                        <div class="item-left">\n                            <img class="left-item" v-if="item.type!=3" :src="item.imgUrl" alt="">\n                            <input type="file" class="left-item left-input-img" accept="image/*" @change.stop="tabImgFun(i,$event)">\n                            <video class="left-item" v-if="item.type==3" :src="item.imgUrl"></video>\n                            <img class="left-item left-video" v-if="item.type==3" src="../imgs/bg_video.png">\n                            <input type="file" class="left-item left-input-video" v-if="item.type==3" accept="video/*" @change.stop="tabImgFun(i,$event)">\n                        </div>\n                        <div class="item-right">\n                            <textarea placeholder="点击添加文字" :value="item.c_text" class="right-item" @click="addContent(i,$event)" :ref="item.t_ref">\n\n                            </textarea>\n                        </div>\n                    </div>\n                    <div class="addItem" :ref="item.c_ref" @click.stop="hideAddBottom(item.ref,item.c_ref,$event)" v-if="addBottomFlag+\'i\'">+</div>\n                    <div class="add-content" :ref="item.ref">\n                        <input type="file" class="selectImg" accept="image/*" multiple="multiple" @change.stop="addImgFun(i,$event)">\n                        <input type="file" class="selectVideo" accept="video/*" multiple="multiple" @change.stop="addVideoFun(i,$event)">\n                        <span class="icon-text" @click.stop="addTextFun(i)"></span>\n                        <span class="icon-img"></span>\n                        <span class="icon-video"></span>\n                    </div>\n                </div>\n            </div>\n            <div class="second-footer" @click.stop="submitContent">\n                <p class="s-footer-text">完成</p>\n            </div>\n        </div>',data:function(){return{activeSecond:!0,imgArr:[],b_img:0,isShowHead:!1,addTopFlag:!0,addBottomFlag:!0,default_ref:"",c_default_ref:"",t_default_ref:"",title:"",fromIndex:"",headBgImg:"./imgs/bg_header1.jpg",selectBgImg:!1,bgImgArr:[]}},beforeRouteEnter:function(t,e,i){console.log(e.path,"/","/"==e.path),"/"==e.path?this.fromIndex="/":this.fromIndex="","/"==e.path?this.fromIndex="/":this.fromIndex="",i()},beforeRouteLeave:function(t,e,i){this.fromIndex="",i()},created:function(){this.t_default_ref=this.$store.getters.t_default_ref||"",localStorage.getItem("t_index")&&"NaN"!=localStorage.getItem("t_index")?this.t_index=parseInt(localStorage.getItem("t_index")):this.t_index=0},mounted:function(){console.log("this.fromIndex",this.fromIndex),this.imgArr=this.$store.getters.imgArrList,this.headBgImg=this.imgArr[0].imgUrl,this.title=this.$store.getters.title||"",console.log(this.title);var t=this;this.$nextTick(function(){console.log(t.fromIndex),"/"==t.fromIndex&&setTimeout(function(){alert("最多可以添加10张图噢")},300)})},methods:{changeImgIndex:function(t,e,i){console.log(t,e,i);console.log(1111,this.imgArr);var s=this,n=this.imgArr;setTimeout(function(){1<i&&(o(s.imgArr,t,0==e?t-1:t+1),s.$store.commit("ADDIMGARR",n))},100)},tabBgImgFun:function(){var e=this;this.bgImgArr=[],this.imgArr.forEach(function(t){1==t.type&&e.bgImgArr.push(t)}),setTimeout(function(){e.selectBgImg=!0},50)},selectBgImgFun:function(t,e){this.b_img=t,this.headBgImg=e,this.selectBgImg=!1},hideAddFlag:function(){this.addTopFlag=!0,""!=this.default_ref&&(this.$refs[this.default_ref][0].style.display="none"),console.log(this.c_default_ref),""!=this.c_default_ref&&(this.$refs[this.c_default_ref][0].style.display="block")},hideAddBottom:function(t,e,i){console.log(t,e),this.default_ref=t,this.c_default_ref=e,console.log(this.$refs,this.c_default_ref),""!=this.default_ref&&(this.$refs[this.default_ref][0].style.display="none"),""!=this.c_default_ref&&(this.$refs[this.c_default_ref][0].style.display="block"),this.addTopFlag=!0,i.target.style.display="none",this.$refs[t][0].style.display="block"},addTextFun:function(t){this.$store.commit("EDITVALUE","");var e=this.t_index+1;localStorage.setItem("t_index",e),console.log(this.$router),this.$router.push({path:"/edit",query:{insert:t}})},tabImgFun:function(t,e){var i=a(e.target.files[0],this);this.imgArr[t].imgUrl=i;var s=this;this.imgArr.forEach(function(t){1==t.type&&s.bgImgArr.push(t)}),this.headBgImg=this.bgImgArr[0].imgUrl,this.$store.commit("ADDIMGARR",this.imgArr)},addImgFun:function(t,e){e.target.files;var i=localStorage.getItem("img_index")||0,s=parseInt(i);localStorage.setItem("img_index",s+1);this.imgArr.forEach(function(t,e){1==t.type&&1});var n,c,o=this;n=6,c=o,wx.chooseImage({count:n,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var e=t.localIds;!function i(s,n){var t=s.pop();wx.uploadImage({localId:t,isShowProgressTips:1,success:function(t){var e=t.serverId;l.push(saveImg(e)),0<s.length?i(s,n):(n(l),l=[])}})}(e,c)}})},addVideoFun:function(i,t){console.log("添加视频",i,t);var e=t.target.files,s=localStorage.getItem("v_index")||0,n=parseInt(s);console.log(e),localStorage.setItem("v_index",n+1);for(var c=this,o=0,a=e.length;o<a;o++)r(e[o],c,function(t){var e={imgUrl:t,c_text:"",ref:"video"+n+o,c_ref:"c_video"+n+o,t_ref:"t_video"+n+o,type:3};c.imgArr.splice(i+1,0,e),c.$store.commit("ADDIMGARR",c.imgArr)})},addContent:function(t,e){this.$store.commit("CURRENTINDEX",t),this.$router.push({path:"/edit"});var i="";e&&(i=e.target.value),console.log(),this.$store.commit("EDITVALUE",i)},removeCurrentFun:function(t,e){var i=0;this.imgArr.forEach(function(t){1==e&&1==t.type&&(i+=1)});var s=this;this.imgArr.forEach(function(t){1==t.type&&s.bgImgArr.push(t)}),this.headBgImg=this.bgImgArr[0].imgUrl,1==i?alert("至少要保留一张照片"):(this.imgArr.splice(t,1),this.$store.commit("ADDIMGARR",this.imgArr))},addMusicFun:function(){this.$router.push({path:"/music"})},submitContent:function(){if(""==this.title)alert("标题不能为空"),this.addContent("contentTitle","");else{var t=JSON.stringify(this.imgArr);this.commitJSONHtml(t,this.imgArr),this.$router.push({path:"/review"})}},commitJSONHtml:function(t,e){for(var i=0,s=e.length;i<s;i++)'<div class="review-item"><p class="item-text">'+e[i].c_text+'</p><img class="item-img" src="'+e[i].imgSrc+'"></div>';var n=t;this.$http.post(c,{htmlStr:'<div class="review-list">+listStr+</div>',jsonObj:n}).then(function(t){console.log("html片段和json提交成功",t)})}}}},{path:"/edit",component:{template:'<div class="index-edit">\n            <textarea class="edit-content"  @focus="focusFun" @blur.passive="blurFun" v-model="editValue"  ref="editObj" @input="editFun">\n\n            </textarea>\n            <div class="edit-num">{{textNum}}/{{maxNum}}</div>\n            <div class="edit-btn" v-if="showSubmit">\n                <span class="btn-submit" @click.stop="submitEdit">完成</span>\n            </div>\n        </div>',data:function(){return{editValue:"",showSubmit:!0,t_default_ref:"",textNum:0,maxNum:5e3,imgArr:"",index:"",t_index:0,isInsert:{flag:!1,index:null}}},created:function(){this.editValue=this.$store.getters.editValue||"",this.textNum=this.editValue.length,this.t_default_ref=this.$store.getters.t_default_ref||"",this.imgArr=this.$store.getters.imgArrList,console.log(this.$store.getters.index),this.index=this.$store.getters.index,"contentTitle"==this.index&&(this.maxNum=50),null==this.$route.query.insert&&null==this.$route.query.insert||(this.isInsert.flag=!0,this.isInsert.index=this.$route.query.insert,console.log("localStorage.t_index="+this.$store.getters.t_index),this.t_index=parseInt(localStorage.getItem("t_index")))},methods:{editFun:function(){this.editValue.length>this.maxNum&&(this.editValue=this.editValue.substr(0,this.maxNum)),this.textNum=this.editValue.length},blurFun:function(){this.showSubmit=!1},focusFun:function(){this.showSubmit=!0},submitEdit:function(){var t=this.editValue,e=this.index;console.log("this.index"+this.index);this.imgArr;if(1==this.isInsert.flag){var i={imgUrl:"./imgs/bg_text.png",c_text:t,ref:"text"+this.t_index,c_ref:"c_text"+this.t_index,t_ref:"t_text"+this.t_index,type:2};console.log("i="+e),n(this.imgArr,this.isInsert.index,i),this.$store.commit("SETTINDEX",this.t_index),this.$store.commit("ADDIMGARR",this.imgArr)}else"contentTitle"==e?this.$store.commit("SETTITLE",t):(this.imgArr[e].c_text=t,console.log(this.imgArr),this.$store.commit("ADDIMGARR",this.imgArr));var s=this;setTimeout(function(){s.$router.push({path:"/second"})},100)}}}},{path:"/music",component:{template:'<div class="index-music">\n            <div class="tab-list">\n                <div class="tab-item" @click="selectFun(1)" :class="isActive?\'active\':\'\'">\n                    <span>选择音乐</span>\n                </div>\n                <div class="tab-item" @click="selectFun(0)" :class="isActive?\'\':\'active\'">\n                    <span>搜索音乐</span>\n                </div>\n            </div>\n           <div class="music-select" v-show="isActive">\n               <div class="music-no music-item" :class="\'no\'==d_index?\'selected\':\'\'" @click="selectType(\'no\')">\n                   <p class="item-title">无背景音乐</p>\n               </div>\n               <li class="music-list music-item"  v-for="(item,j) in musicTypeList" :key="j" >\n                   <div class="top-content" :class="d_index==j&&!typeSelected?\'hasSelected\':\'\'" @click="selectType(j)">\n                       <div>\n                           <p class="item-title">{{item.typeName}}</p>\n                           <p class="item-text">包含{{item.musicNum}}首歌曲</p>\n                       </div>\n                   </div>\n                   <div v-if="d_index==j">\n                       <div v-show="typeSelected">\n                           <ul class="b-content-list">\n                               <li class="b-content-item" v-for="(item,m) in musicList"  :key="m" @click="selectMusic(m,item.musicId)" :class="m_index == m?\'selected\':\'\'">{{item.musicName}}</li>\n                           </ul>\n                       </div>\n                   </div>\n\n               </li>\n               <div class="empty">\n\n               </div>\n               <div class="music-footer" @click="submitSelect(1)">\n                   <p class="s-footer-text">完成</p>\n               </div>\n           </div>\n            <div class="music-search" v-show="!isActive">\n                <div class="search-content">\n                    <i class="icon-search"></i>\n                    <input type="text" placeholder="搜索在线音乐">\n                </div>\n\n                <div class="music-footer" @click="submitSelect(0)">\n                    <p class="s-footer-text">完成</p>\n                </div>\n            </div>\n        </div>',data:function(){return{isActive:!0,musicTypeList:[{typeName:"圣诞",musicNum:8,TypeId:123,musicSrc:""},{typeName:"欢快",musicNum:10,TypeId:124,musicSrc:""},{typeName:"优美",musicNum:13,TypeId:125,musicSrc:""},{typeName:"浪漫",musicNum:9,TypeId:126,musicSrc:""},{typeName:"激情",musicNum:9,TypeId:127,musicSrc:""},{typeName:"激情1",musicNum:9,TypeId:128,musicSrc:""},{typeName:"激情2",musicNum:9,TypeId:129,musicSrc:""},{typeName:"激情3",musicNum:9,TypeId:130,musicSrc:""}],selectMusicId:"",musicList:[{TypeId:123,musicId:11,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:12,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:13,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:14,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:15,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:16,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:17,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:18,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:19,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""},{TypeId:123,musicId:20,musicName:"那个人",musicAuthor:"周延英",musicUrl:"http://sc1.111ttt.cn:8282/2018/1/03m/13/396131232171.m4a?tflag=1519095601&pin=6cd414115fdb9a950d827487b16b5f97#.mp3",picture:""}],d_index:null,c_index:null,m_index:0,musicId:"",typeSelected:!1}},created:function(){console.log(this.d_index)},mounted:function(){console.log(123)},methods:{selectFun:function(t){this.isActive=!!t},selectType:function(t){this.typeSelected=!this.typeSelected,"no"==t&&(this.musicId=""),this.d_index=t,this.c_index!=t&&(this.m_index=0),this.c_index=t,console.log(this.d_index==t&&!this.typeSelected)},selectMusic:function(t,e){console.log(t),this.m_index=t,this.musicId=e},submitSelect:function(t){console.log("this.musicId=",this.musicId),this.$router.push({path:"/second"})}}}},{path:"/review",component:{template:'<div class="index-review">\n            <div class="review-header">\n                <i class="head-item icon-home" @click="toBackHome"></i>\n                <span class="head-item head-back-home" @click="toBackHome">回到首页</span>\n                <span class="head-item head-edit" @click="editPage">编辑</span>\n            </div>\n            <div class="review-content">\n                <h3 class="review-title">设置标题</h3>\n                <div class="review-userInfo">\n                    <span class="info-date">{{userInfoObj.date}}</span><span class="info-name">{{userInfoObj.name}}</span><span class="info-text">阅读 {{userInfoObj.num}}</span>\n                </div>\n\n                <div class="review-list">\n                    <div class="review-item" v-for="(item,r) in imgArr" :key="r">\n                        <p class="item-text">{{item.c_text}}</p>\n                        <img v-if="item.type == 1" class="item-img" :src="item.imgUrl">\n                        <video v-if="item.type == 3" controls class="item-video" :src="item.imgUrl"></video>\n                    </div>\n                </div>\n            </div>\n        </div>',created:function(){this.imgArr=this.$store.getters.imgArrList,this.title=this.$store.getters.title},data:function(){return{userInfoObj:{date:"2018-05-15",name:"username123",num:0},title:"",imgArr:"",musicId:"",musicUrl:""}},methods:{toBackHome:function(){this.$router.push({path:"/"})},editPage:function(){this.$store.commit("ADDIMGARR",this.imgArr),this.$store.commit("SETTITLE",this.title),this.$router.push({path:"/second"})}}}}]});new Vue({router:s,store:i,el:"#app",data:{imgArr:[123]},mounted:function(){},methods:{}});function a(t,e,i){var s=null;return null!=window.createObjectURL?s=window.createObjectURL(t):null!=window.URL?s=window.URL.createObjectURL(t):null!=window.webkitURL&&(s=window.webkitURL.createObjectURL(t)),s}var l=[];function r(t,e,i){var s=null;if(e=e){var n=new FormData;n.append("file",t),console.log("fileData=",t,n),e.$http.post(c+"/upload/kindeditorJson?rename=1",n).then(function(t){s=c+t.body.path,console.log(t),console.log(s),i&&i(s)})}}function n(t,e,i){-1==e?t.unshift(i):t.splice(e+1,0,i)}}();